"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decode = void 0;
const unzip_1 = require("./unzip");
const dechunk_1 = require("./dechunk");
const split_1 = require("./split");
const uncompress_1 = require("./uncompress");
async function* decode(data, registry) {
    for await (const entry of (0, unzip_1.unzip)(data)) {
        if ((0, unzip_1.isIwaFile)(entry.name)) {
            const chunks = [];
            for await (const snappyChunk of (0, dechunk_1.dechunk)(entry.data)) {
                const objects = [];
                const chunk = await (0, uncompress_1.uncompress)(snappyChunk.data);
                for await (const message of (0, split_1.splitObjectsAs)(chunk, registry)) {
                    objects.push(message);
                }
                chunks.push({
                    ...snappyChunk,
                    data: chunk,
                    objects
                });
            }
            yield {
                type: 'iwa',
                name: entry.name,
                chunks
            };
        }
        else {
            yield {
                type: 'file',
                ...entry
            };
        }
    }
}
exports.decode = decode;
//# sourceMappingURL=decode.js.map